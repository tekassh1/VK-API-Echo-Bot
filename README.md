# VK API Bot

### Использованные технологии
* **Spring Boot**
* **Docker**
* **JUnit**
* **Mockito**
* **Spring Web**
* **Sprint WebFlux**
* **Log4j**
* **ngrok**

Бот обрабатывает все HTTP ошибки и ошибки VK API. Для всех ошибок ведётся логирование соответствующего уровня в консоль.
При добавлении бота в беседы, в которых состоит несколько человек, он цитирует каждого по имени, а не на "вы", делая запрос к VK API.
Также написаны JUnit тесты для проверки основных исключительных ситуаций приложения.

### Настройка бота

#### Со стороны сообщества VK:
* В разделе `Управление сообществом -> Работа с API` необходимо создать токен доступа к VK API.
* В разделе `Управление сообществом -> Работа с API` необходимо задать 'Секретный ключ', который будет передаваться с каждым сообщением.
* Там же необходимо включить поддержку `Callback API`.
* В типах событий выбрать `Входящее сообщение`.
* Запомнить строку, которую должен вернуть сервер для первого подтверждения.

#### Со стороны сервера:
* Генерируем gradle wrapper файлы: `gradle wrapper` (Gradle-8.10.2, Java 21).
* Собираем проект `./gradlew build`.
* В файле `docker-compose.yml` задаем переменные для использования в приложении:
* * `SERVER_ACCESS_TOKEN` - токен доступа к VK API.
* * `SERVER_CONFIRMATION_TOKEN` - ключ единоразового подтверждения сервера.
* * `SERVER_SECRET_KEY` - токен, который будет передаваться с каждым событием для верификации того, что событие пришло действительно с VK (Секретный ключ).
* Задаём версию VK API - она должна совпадать с версией в настройках сообщества. (тестировалось на 5.199)
* Переходим в `ngrok.yml` и для параметра `authtoken` указываем токен, который выдаётся при регистрации в ngrok.
* Запускаем контейнеры командой `docker-compose up`.
* Переходим на `http://localhost:4040` и запоминаем адрес, который нам предоставил ngrok. 

#### Со стороны сообщества VK:
* Вставляем наш адрес ngrok в раздел `Адрес`
* Подтверждаем сервер

#### Ботом можно пользоваться!
* При использовании в чате ему необходимо предоставить права администратора.
